# Start from the official NGINX image
FROM nginx:1.25-alpine

# Temporarily switch to root user to create necessary directories
USER root

# Create and set permissions for NGINX cache directories
RUN mkdir -p /var/cache/nginx/{client_temp,proxy_temp,fastcgi_temp,uwsgi_temp,scgi_temp} \
    && chown -R nginx:nginx /var/cache/nginx

# Validate NGINX configuration (optional but recommended)
COPY nginx.conf /etc/nginx/nginx.conf
RUN nginx -t

# Switch back to the non-root user
USER 1001

# Expose the necessary port
EXPOSE 8080

# Add custom configuration and static files
COPY nginx.conf /etc/nginx/nginx.conf
COPY ./html /usr/share/nginx/html

# Set default command
CMD ["nginx", "-g", "daemon off;"]
