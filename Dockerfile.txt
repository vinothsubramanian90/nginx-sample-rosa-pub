# Start from the official NGINX image
FROM nginx:1.25-alpine

# Temporarily switch to root user for setup
USER root

# Create necessary directories and adjust permissions for the non-root user (1001)
RUN mkdir -p /var/cache/nginx/{client_temp,proxy_temp,fastcgi_temp} \
    && chown -R 1001:1001 /var/cache/nginx

# Remove default.conf to avoid conflicts if custom configs are provided
RUN rm -f /etc/nginx/conf.d/default.conf

# Switch back to the non-root user
USER 1001

# Expose the necessary port
EXPOSE 8080

# Add custom configuration and static files
COPY nginx.conf /etc/nginx/nginx.conf
COPY ./html /usr/share/nginx/html

# Set the default command
CMD ["nginx", "-g", "daemon off;"]
